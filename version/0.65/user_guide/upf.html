
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using Python to code UPF subroutines &#8212; PyMAPDL</title>

  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=e5fbc548" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/css/ansys_sphinx_theme.css?v=068850c2" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />
 
<link href="../_static/css/breadcrumbs.css" rel="stylesheet" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=77059071"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=49e1bf35"></script>
    <script src="../_static/js/table.js?v=b64f5182"></script>
    <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-JQJKPV6ZVB"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-JQJKPV6ZVB');
            </script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/upf';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://mapdl.docs.pyansys.com/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '0.65';
        </script>
    <link rel="icon" href="../_static/ansys-favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Harmonic analysis using the Krylov method" href="krylov.html" />
    <link rel="prev" title="File explorer overview" href="xpl.html" />
<link rel="stylesheet" type="text/css" href="../_static/custom.css" />


  <link rel="canonical" href="https://mapdl.docs.pyansys.com/version/stable/user_guide/upf.html" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container"><!-- Debugging: html_theme_options =  -->

<!-- If there is no MiliSearch enabled, use the PyData search -->
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
   
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/pyansys-logo-black-cropped.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/pyansys-logo-black-cropped.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started/index.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../mapdl_commands/index.html">
                        MAPDL commands
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../examples/index.html">
                        Examples
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown">
      0.65  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pyansys/pymapdl" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pyansys/pymapdl/discussions" title="Support" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa fa-comment fa-fw"></i></span>
            <label class="sr-only">Support</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://mapdl.docs.pyansys.com/version/dev/getting_started/contribution.html" title="Contribute" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa fa-wrench"></i></span>
            <label class="sr-only">Contribute</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
    <div id="announcement_msg"></div>
<script>
  fetch("announcement.html")
    .then((response) => {
      if (!response.ok) {
        throw new Error(`HTTP error: ${response.status}`);
      }
      return response.text();
    })
    .then(
      (text) => (document.getElementById("announcement_msg").innerHTML = text),
    )
    .catch((error) => console.error(`Fetch problem: ${error.message}`));
</script>   <div class="container-xl">
  <div class="row">
    <div class="col-12 col-md-3" id="breadcrumbs-spacer"></div>
    <div class="col-12 col-md-11 col-xl-9" id="breadcrumbs">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul> 
<li class="nav-item nav-item-additional-breadcrumb">
  <a href="https://docs.pyansys.com/">PyAnsys</a> » 
</li>
 
<li class="nav-item nav-item-0">
  <a href="../index.html">PyMAPDL</a> » 
</li>
 
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">User guide</a> » </li>
        <li class="nav-item nav-item-this"><a href="">Using Python to code UPF subroutines</a></li> 
      </ul>
    </div></div>
  </div>
</div>
 
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started/index.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../mapdl_commands/index.html">
                        MAPDL commands
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../examples/index.html">
                        Examples
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown">
      0.65  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pyansys/pymapdl" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pyansys/pymapdl/discussions" title="Support" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa fa-comment fa-fw"></i></span>
            <label class="sr-only">Support</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://mapdl.docs.pyansys.com/version/dev/getting_started/contribution.html" title="Contribute" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa fa-wrench"></i></span>
            <label class="sr-only">Contribute</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="launcher.html">Initial setup and launch of MAPDL locally</a></li>
<li class="toctree-l1"><a class="reference internal" href="mapdl.html">PyMAPDL language and usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="mapdl_examples.html">ANSYS APDL interactive control examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html">Interactive plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="mesh_geometry.html">Mesh and geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="post.html">Postprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Setting and retrieving parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Access MAPDL database</a></li>
<li class="toctree-l1"><a class="reference internal" href="convert.html">Translate scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="math.html">APDL Math overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="pool.html">Create a pool of MAPDL instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="xpl.html">File explorer overview</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Using Python to code UPF subroutines</a></li>
<li class="toctree-l1"><a class="reference internal" href="krylov.html">Harmonic analysis using the Krylov method</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshoot.html">Troubleshooting PyMAPDL</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article"></div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="using-python-to-code-upf-subroutines">
<span id="python-upf"></span><h1>Using Python to code UPF subroutines<a class="headerlink" href="#using-python-to-code-upf-subroutines" title="Permalink to this heading">#</a></h1>
<p>As an alternative to compiled languages like C and Fortran, you can use the
Python language to code user programmable subroutines. A subset of the
documented UPF subroutines support the Python UPF capability. For more information,
see <a class="reference internal" href="#supported-upf-subroutines">Supported UPF subroutines</a>).</p>
<p>You must install a Python distribution before using this feature. Python 3.6
through Python 3.7 are supported.</p>
<p>Python UPFs are only supported on Linux.</p>
<p>You are strongly advised to start your code based on one of the examples in
<a class="reference internal" href="#python-upf-examples">Python UPF examples</a>.  In your Python code, you can make use of standard
Python libraries like NumPy.</p>
<p>These topics are available:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#supported-upf-subroutines">Supported UPF subroutines</a></p></li>
<li><p><a class="reference internal" href="#python-upf-methodology">Python UPF methodology</a></p></li>
<li><p><a class="reference internal" href="#accessing-the-database-from-the-python-code">Accessing the database from the Python code</a></p></li>
<li><p><a class="reference internal" href="#python-upf-limitations">Python UPF limitations</a></p></li>
<li><p><a class="reference internal" href="#python-upf-examples">Python UPF examples</a></p></li>
</ul>
<section id="supported-upf-subroutines">
<h2>Supported UPF subroutines<a class="headerlink" href="#supported-upf-subroutines" title="Permalink to this heading">#</a></h2>
<p>A subset of the entire set of available UPF subroutines supports Python coding. The following
table lists those that are supported.</p>
<p><strong>Table 1: Python support for subroutines</strong></p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Subroutine</strong></p></th>
<th class="head"><p><strong>Fortran description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><p><strong>Material behavior</strong></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">UserMat</span></code></p></td>
<td><p>Subroutine <code class="docutils literal notranslate"><span class="pre">UserMat</span></code> (Creating Your Own Material Model)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">UserMatTh</span></code></p></td>
<td><p>Subroutine <code class="docutils literal notranslate"><span class="pre">UserMatTh</span></code> (Creating Your Own Thermal Material Model)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">UserHyper</span></code></p></td>
<td><p>Subroutine <code class="docutils literal notranslate"><span class="pre">UserHyper</span></code> (Writing Your Own Isotropic Hyperelasticity Laws)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">UserCreep</span></code></p></td>
<td><p>Subroutine <code class="docutils literal notranslate"><span class="pre">UserCreep</span></code> (Defining Creep Material Behavior)</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p><strong>Modifying and Monitoring Elements</strong></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">UsrShift</span></code></p></td>
<td><p>Subroutine <code class="docutils literal notranslate"><span class="pre">UsrShift</span></code> (Calculating Pseudotime Time Increment)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">UTimeInc</span></code></p></td>
<td><p>Subroutine <code class="docutils literal notranslate"><span class="pre">UTimeInc</span></code> (Overriding the Program-Determined Time Step)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">UCnvrg</span></code></p></td>
<td><p>Subroutine <code class="docutils literal notranslate"><span class="pre">UCnvrg</span></code> (Overriding the Program-Determined Convergence)</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p><strong>Customizing loads</strong></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">usrefl</span></code></p></td>
<td><p>Subroutine <code class="docutils literal notranslate"><span class="pre">usrefl</span></code> (Changing Scalar Fields to User-Defined Values)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">userpr</span></code></p></td>
<td><p>Subroutine <code class="docutils literal notranslate"><span class="pre">userpr</span></code> (Changing Element Pressure Information)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">usercv</span></code></p></td>
<td><p>Subroutine <code class="docutils literal notranslate"><span class="pre">usercv</span></code> (Changing Element Face Convection Surface Information)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">userfx</span></code></p></td>
<td><p>Subroutine <code class="docutils literal notranslate"><span class="pre">userfx</span></code> (Changing Element Face Heat Flux Surface Information)</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p><strong>Accessing subroutines</strong></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">UanBeg</span></code> / <code class="docutils literal notranslate"><span class="pre">UanFin</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">USolBeg</span></code> / <code class="docutils literal notranslate"><span class="pre">USolFin</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">ULdBeg</span></code> / <code class="docutils literal notranslate"><span class="pre">ULdFin</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">UItBeg</span></code> / <code class="docutils literal notranslate"><span class="pre">UItFin</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">USsBeg</span></code> / <code class="docutils literal notranslate"><span class="pre">USsFin</span></code></p>
</td>
<td><p>Access at the beginning and end of various operations</p></td>
</tr>
</tbody>
</table>
</section>
<section id="python-upf-methodology">
<h2>Python UPF methodology<a class="headerlink" href="#python-upf-methodology" title="Permalink to this heading">#</a></h2>
<p>Coding a Python UPF is different from using a compiled language like C/C++ or Fortran,
mainly in terms of the API. Because the <a class="reference external" href="https://grpc.io/">gRPC technology</a> is used to handle
the communication and the exchange of data between the Python process and the Mechanical APDL
process, you need to understand the way this feature handles the serialization and
deserialization of data.</p>
<p>The main difference is in the subroutine arguments. Instead of having a full list of
arguments as described for each of the subroutines, there are only two: the request
object (for inputs), and the response object (for outputs). If an argument is both input
and output of the subroutine, it is part of both objects.</p>
<p>The description of the request object and the response object can be found in the
<code class="docutils literal notranslate"><span class="pre">MapdlUser.proto</span></code> file stored in this installation directory:</p>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">Ansys Inc\vXXX\ansys\syslib\ansGRPC\User</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">XXX</span></code> is the version of Mechanical APDL you are using.
For example <code class="docutils literal notranslate"><span class="pre">222</span></code> for Mechanical APDL 2022R2.</p>
<p>First, create a Python file starting from this template:</p>
<p><strong>my_upf.py</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">grpc</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">mapdl</span> <span class="kn">import</span> <span class="o">*</span>


<span class="k">class</span> <span class="nc">MapdlUserService</span><span class="p">(</span><span class="n">MapdlUser_pb2_grpc</span><span class="o">.</span><span class="n">MapdlUserServiceServicer</span><span class="p">):</span>
    <span class="c1">#   #################################################################</span>
    <span class="k">def</span> <span class="nf">UAnBeg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ======================================= &quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &gt;&gt; Inside the PYTHON UAnBeg routine  &lt;&lt; &quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ======================================= </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">google_dot_protobuf_dot_empty__pb2</span><span class="o">.</span><span class="n">_EMPTY</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">upf</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>Note that Mechanical APDL automatically installs a Mechanical APDL Python package (a
set of Python functions) to handle the connection between Mechanical APDL and the Python
environment. Each Python UPF must be imported:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mapdl</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>The preceding example redefines the <cite>UAnBeg</cite> routine and prints a
customized banner. This file must be in the same directory as the input file.</p>
<p>To use this Python UPF, you must add the Mechanical APDL <code class="docutils literal notranslate"><span class="pre">/UPF</span></code> command to your
input file (<code class="docutils literal notranslate"><span class="pre">my\_inp.dat</span></code>).</p>
<div class="highlight-apdl notranslate"><div class="highlight"><pre><span></span><span class="k">/UPF</span><span class="p">,</span><span class="s1">&#39;my_upf.py&#39;</span>

<span class="c">! The UAnBeg UPF must be activated by using the USRCAL APDL command</span>

<span class="k">USRCAL</span><span class="p">,</span><span class="nv">UANBEG</span>
</pre></div>
</div>
<p>This command is trapped by the Mechanical APDL Launcher so that a Python gRPC server is up
and running when the Mechanical APDL process starts.</p>
<p>When launching Mechanical APDL using this input file, you see the following printout to
indicate Mechanical APDL detected the Python UPF instructions and has launched a Python
server:</p>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">Processing &quot;/upf&quot; found in input file &quot;my_inp.dat&quot;</span>

<span class="go">Python UPF Detected</span>

<span class="go">PYTHON VERSION : 3.6</span>
<span class="go">&gt;&gt;</span>
<span class="go">&gt;&gt; START PYTHON GRPC SERVER</span>
<span class="go">&gt;&gt;</span>
<span class="go">&gt;&gt; User Functions Python File :  my_upf.py</span>
<span class="go">&gt;&gt;</span>
<span class="go">&gt;&gt; Server started on port [50054]</span>
</pre></div>
</div>
<p>During the Mechanical APDL process, you see this Python printout:</p>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">RUN SETUP PROCEDURE FROM FILE= /ansys_inc/v212/ansys/apdl/start.ans</span>
<span class="go">=======================================</span>
<span class="go">&gt;&gt; Inside the PYTHON UAnBeg routine  &lt;&lt;</span>
<span class="go">=======================================</span>
</pre></div>
</div>
<p>At the very end of the process, the Python server is automatically shut
down:</p>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">|-----------------------------------------------------------------|</span>
<span class="go">|                                                                 |</span>
<span class="go">|   CP Time      (sec) =          0.326       Time  =  10:40:24   |</span>
<span class="go">|   Elapsed Time (sec) =          2.000       Date  =  03/11/2021 |</span>
<span class="go">|                                                                 |</span>
<span class="go">*-----------------------------------------------------------------*</span>

<span class="go">&gt;&gt; We shutdown Python Server(s)</span>
</pre></div>
</div>
</section>
<section id="accessing-the-database-from-the-python-code">
<h2>Accessing the database from the Python code<a class="headerlink" href="#accessing-the-database-from-the-python-code" title="Permalink to this heading">#</a></h2>
<p>Within your UPF routine, you might need to access the Mechanical APDL database in read/write
mode.</p>
<p>In the Python code, you can create a connection with the DB server. This command must
be called only once, so that you can protect the call based on the value of a static
variable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">grpc</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">mapdl</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">firstcall</span> <span class="o">=</span> <span class="mi">1</span>


<span class="k">class</span> <span class="nc">MapdlUserService</span><span class="p">(</span><span class="n">MapdlUser_pb2_grpc</span><span class="o">.</span><span class="n">MapdlUserServiceServicer</span><span class="p">):</span>
    <span class="c1">#   ###############################################################</span>
    <span class="k">def</span> <span class="nf">UserMat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">firstcall</span>

        <span class="k">if</span> <span class="n">firstcall</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt;&gt; Connection to the MAPDL DB Server</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">firstcall</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># continuation of the python function</span>
        <span class="c1"># ...</span>
</pre></div>
</div>
<p>Once the DB connection has been initialized, you can access the database of the
Mechanical APDL instance in read/write mode.</p>
<p>Of the functions documented in accessing the Mechanical APDL Database, a
subset has been exposed so that they can be called from the Python code.
The following table describes the exposed functions.</p>
<p><strong>Table 2. Supported database access functions</strong></p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p><strong>Supported database access functions</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">db.start()</span></code></p></td>
<td><p>Initializes the connection with a running Mechanical APDL instance. The DB Server is automatically started in Mechanical APDL if a <strong>/UPF</strong> command with a Python file has been detected.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">db.stop()</span></code></p></td>
<td><p>Closes the connection with the DB Server.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">db.ndnext(next)</span></code></p></td>
<td><p>Equivalent to the function described in function <code class="docutils literal notranslate"><span class="pre">ndnext</span></code> (Getting the Next Node Number)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">db.ndinqr(ind,</span> <span class="pre">key)</span></code></p></td>
<td><p>Equivalent to the function described in function <code class="docutils literal notranslate"><span class="pre">ndinqr</span></code> (Getting Information About a Node)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">db.getnod(inod)</span></code></p></td>
<td><p>Equivalent to the function described in function <code class="docutils literal notranslate"><span class="pre">getnod</span></code> (Getting a Nodal Point)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">db.putnod(inod,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">z)</span></code></p></td>
<td><p>Equivalent to the function described in function <code class="docutils literal notranslate"><span class="pre">putnod</span></code> (Storing a Node)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">db.elnext(ielm)</span></code></p></td>
<td><p>Equivalent to the function described in function <code class="docutils literal notranslate"><span class="pre">elnext</span></code> (Getting the Number of the Next Element)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">db.getelem(ielm)</span></code></p></td>
<td><p>Equivalent to the function described in function <code class="docutils literal notranslate"><span class="pre">elmget</span></code> (Getting an Element’s Attributes and Nodes)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">db.get_ElmInfo(inquire)</span></code></p></td>
<td><p>Equivalent to the function <code class="docutils literal notranslate"><span class="pre">get\_ElmInfo</span></code> described in accessing Solution and Material Data</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">db.get_ElmData(kchar,</span> <span class="pre">elemId,</span> <span class="pre">kMatRecPt,</span> <span class="pre">ncomp,</span> <span class="pre">vect)</span></code></p></td>
<td><p>Equivalent to the function <code class="docutils literal notranslate"><span class="pre">get\_ElmData</span></code> described in accessing Solution and Material Data</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">db.putElmData(inquire,</span> <span class="pre">elemId,</span> <span class="pre">kIntg,</span> <span class="pre">nvect,</span> <span class="pre">vect)</span></code></p></td>
<td><p>Equivalent to the function <code class="docutils literal notranslate"><span class="pre">put\_ElmData</span></code> described in accessing Solution and Material Data</p></td>
</tr>
</tbody>
</table>
</section>
<section id="python-upf-limitations">
<h2>Python UPF limitations<a class="headerlink" href="#python-upf-limitations" title="Permalink to this heading">#</a></h2>
<p>The Python UPF capability has these limitations:</p>
<ul class="simple">
<li><p>Currently, Distributed Ansys is not supported. You must specify the <code class="docutils literal notranslate"><span class="pre">-smp</span></code> option on the command line to make sure Mechanical APDL is running in shared-memory processing mode.</p></li>
<li><p>Python UPFs are only available on Linux platforms.</p></li>
</ul>
</section>
<section id="python-upf-examples">
<h2>Python UPF examples<a class="headerlink" href="#python-upf-examples" title="Permalink to this heading">#</a></h2>
<p>The following Python UPF examples are available in <a class="reference internal" href="../examples/extended_examples/Python_UPF/python_upf_examples.html#python-upf-examples"><span class="std std-ref">UPF in PyMAPDL</span></a>:</p>
<ul class="simple">
<li><p>Python <cite>UserMat</cite> subroutine</p></li>
<li><p>Python <cite>UsrShift</cite> subroutine</p></li>
<li><p>Python <cite>UserHyper</cite> subroutine</p></li>
</ul>
</section>
</section>


                </article>
              
              
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-upf-subroutines">Supported UPF subroutines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-upf-methodology">Python UPF methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accessing-the-database-from-the-python-code">Accessing the database from the Python code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-upf-limitations">Python UPF limitations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-upf-examples">Python UPF examples</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  
  <div class="tocsection editthispage">
    <a href="https://github.com/pyansys/pymapdl/edit/main/doc/source/user_guide/upf.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright (c) 2023 ANSYS, Inc. All rights reserved.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.1.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the
  <a href="https://sphinxdocs.ansys.com/version/stable/index.html"
    >Ansys Sphinx Theme</a
  >
  0.10.0. <br />Last updated on
  <span id="date"></span>
</p>
<script>
  var options = { day: "numeric", month: "long", year: "numeric" };
  var lastModifiedDate = new Date(document.lastModified);
  var date = lastModifiedDate.toLocaleDateString("en-US", options);
  document.getElementById("date").innerHTML = date;
</script></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>
