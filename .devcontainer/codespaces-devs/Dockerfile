FROM ghcr.io/ansys/mapdl:v24.1-ubuntu-student

USER root

# General libraries
ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get -qq update && apt-get -qq install -y locales && locale-gen "en_US.UTF-8" && update-locale LC_ALL="en_US.UTF-8"

# Installing libs for testing and docs
RUN apt install -qq -y libgl1-mesa-glx xvfb libgomp1

# Setting up locale
RUN apt-get install -y locales && \
    locale-gen 'en_US.UTF-8' && \
    update-locale LC_ALL='en_US.UTF-8' && \
    sed -i '/en_US.UTF-8/s/^# //g' /etc/locale.gen && \
    locale-gen && \
    echo -e '\nexport LANG=en_US.UTF-8\nexport LANGUAGE=en_US:en\nexport LC_ALL=en_US.UTF-8' >> ~/.bashrc

# Clean up
RUN apt-get -qq clean  && rm -rf /var/lib/apt/lists/*

# Installing Python environment
RUN python3.10 -m venv ./.venv && \
    . ./.venv/bin/activate && \
    pip install pre-commit && \
    pip install ansys-mapdl-core && \
    pip install -r ./.devcontainer/codespaces-devs/requirements.txt && \
    echo -e '\nsource ./.venv/bin/activate' >> ~/.bashrc

USER mapdl
